
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <title>Disaster Management</title>
    <script src="http://www.webglearth.com/v2/api.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- <script>
      function initialize() {
        var earth = new WE.map('earth_div');
        WE.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(earth);

        var marker = WE.marker([51.5, -0.09]).addTo(earth);
        marker.bindPopup("<b>Hello world!</b><br>I am a popup.<br /><span style='font-size:10px;color:#999'>Tip: Another popup is hidden in Cairo..</span>", {maxWidth: 150, closeButton: true}).openPopup();

        var marker2 = WE.marker([30.058056, 31.228889]).addTo(earth);
        marker2.bindPopup("<b>Cairo</b><br>Yay, you found me!", {maxWidth: 120, closeButton: false});

        var markerCustom = WE.marker([50, -9], '/img/logo-webglearth-white-100.png', 100, 24).addTo(earth);

        earth.setView([51.505, 0], 6);
      }
    </script> -->
    

</head>
<style>
#earth_div{top: 0; right: 0; bottom: 0; left: 0; position: absolute !important;}
</style>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold text-gray-900">
                Disaster Management
            </h1>
        </div>
    </header>

    <!-- Main -->
    <main>
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8 flex flex-col">
            <div class="grid grid-flow-row-dense grid-cols-3 ">
                <div class="group relative col-span-2">
                    <div class="w-full h-full bg-gray-200 rounded-md overflow-hidden  sm:aspect-w-2 sm:aspect-h-1 sm:h-64 lg:h-80 xl:h-2/3">
                        <!-- <div id="earth_div" style="width:800px;height:600px;"></div> -->
                        <canvas id="canvasOne" width="800" height="500">
                            Your browser does not support HTML5 Canvas.
                        </canvas>
                    </div>
                    <h3 class="mt-4 text-sm text-gray-500">
                        <a href="#">
                            <p class="hover:text-gray-900">Card Principal</p>
                        </a>
                    </h3>

                    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8 flex flex-col">
                        <div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6">
                            <div class="md:flex md:items-center md:justify-between">
                                <div class="flex-1 min-w-0">
                                    <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:leading-9 sm:truncate">
                                        Options
                                    </h2>
                                    <!-- <input type="text" name="country" id="country" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="Country">
                                    <input type="text" name="state" id="state" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="State">
                                    <input type="text" name="city" id="city" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" placeholder="City"> -->
                                    <div class="row flex mt-3 gap-4 col-12 w-100">
                                        <div class="col-4 w-60">
                                            <label for="country" class="block text-sm font-medium text-gray-700">Country</label>
                                            <input type="text" name="country" id="field_country" autocomplete="country" 
                                            onfocusout="loadData()"
                                            class="border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm">
                                        </div>
                                        <div class="col-4 w-80">
                                            <label for="state" class="block text-sm font-medium text-gray-700">State</label>
                                            <input type="text" name="state" id="field_state" autocomplete="state" 
                                            onfocusout="loadData()"
                                            class="border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm">
                                        </div>  
                                        <div class="col-4 w-80">
                                            <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                                            <input type="text" name="city" id="field_city" autocomplete="city" 
                                            onfocusout="loadData()"
                                            class="border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm">
                                        </div>
                                        <div class="col-4 w-60">
                                            <label for="phone" class="block text-sm font-medium text-gray-700">Phone</label>
                                            <input type="text" name="phone" id="field_phone" autocomplete="phone" 
                                            onfocusout="loadData()"
                                            class="border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm">
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="flex-1 ml-12">
                    <div class="group relative mb-4">
                        <!-- Adicione um ícone de alerta e defina o plano de fundo como laranja -->
                        <div class="alert-color w-full h-full bg-orange-500 rounded-md overflow-hidden group-hover:opacity-75 sm:aspect-w-2 sm:aspect-h-1 sm:h-64 lg:h-80 xl:h-96">
                            <div class="alert-color absolute top-0 left-0 bg-orange-500 text-white py-1 px-2 rounded-tl rounded-br">
                                <span>Alert</span>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-48 h-48 mx-auto my-12 mt-16 text-white">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"></path>
                                <circle cx="12" cy="12" r="10" />
                            </svg>
                            <h3 id="alert-type" class="text-white text-center mx-auto text-2xl font-bold">Alerta</h3>
                        </div>
                    </div>



                    <div class="group relative mb-4">
                        <!-- Adicione um ícone de alerta e defina o plano de fundo como laranja -->
                        <div class="w-full h-full bg-orange-500 rounded-md overflow-hidden group-hover:opacity-75 sm:aspect-w-2 sm:aspect-h-1 sm:h-64 lg:h-80 xl:h-96" style="background-color: rgb(94, 141, 243);">
                            <div class="absolute top-0 left-0 bg-orange-500 text-white py-1 px-2 rounded-tl rounded-br" style="background-color: rgb(94, 141, 243);">
                                <span>Information</span>
                            </div>
                            <svg class="w-32 h-32 mx-auto my-12 mt-16  text-center text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                            </svg>
                            <h3 class="text-white text-center mx-auto text-2xl font-bold" id="country"></h3>
                            <h3 class="text-white text-center mx-auto text-2xl font-bold" id="fromdate"></h3>
                            <h3 class="text-white text-center mx-auto text-2xl font-bold" id="todate"></h3>
                        </div>
                    </div>
                </div>
            </div>


            
        </div>
    </main>


  <script src="https://files.worldwind.arc.nasa.gov/artifactory/web/0.9.0/worldwind.min.js"type="text/javascript"></script>
  <script>
    
    function generateGlobe(locations){
        var wwd = new WorldWind.WorldWindow("canvasOne");

        wwd.addLayer(new WorldWind.BMNGOneImageLayer());
        wwd.addLayer(new WorldWind.BMNGLandsatLayer());

        wwd.addLayer(new WorldWind.CompassLayer());
        wwd.addLayer(new WorldWind.CoordinatesDisplayLayer(wwd));
        wwd.addLayer(new WorldWind.ViewControlsLayer(wwd));

        console.log(locations);
        
        [locations].forEach(location => {
        
            var placemarkLayer = new WorldWind.RenderableLayer(location.descricao);

            var placemarkAttributes = new WorldWind.PlacemarkAttributes(null);

            placemarkAttributes.imageOffset = new WorldWind.Offset(
                WorldWind.OFFSET_FRACTION, 0.3,
                WorldWind.OFFSET_FRACTION, 0.0);

            placemarkAttributes.labelAttributes.color = WorldWind.Color.YELLOW;
            placemarkAttributes.labelAttributes.offset = new WorldWind.Offset(
                        WorldWind.OFFSET_FRACTION, 0.5,
                        WorldWind.OFFSET_FRACTION, 1.0);
            wwd.addLayer(placemarkLayer);

            placemarkAttributes.imageSource = WorldWind.configuration.baseUrl + "images/pushpins/plain-red.png";


            var position = new WorldWind.Position(location.longitude, location.latitude, 100.0);
            var placemark = new WorldWind.Placemark(position, false, placemarkAttributes);

            console.log(placemark);
            placemark.label = location.descricao + "\n" +
                "Lat " + placemark.position.latitude.toPrecision(4).toString() + "\n" +
                "Lon " + placemark.position.longitude.toPrecision(5).toString();
            placemark.alwaysOnTop = true;

            placemarkLayer.addRenderable(placemark);
        });
    }
    
   
    function loadData(type = null){
        
        let country = document.getElementById('field_country').value;
        let state = document.getElementById('field_state').value;
        let city = document.getElementById('field_city').value;
        let phone = document.getElementById('field_phone').value;
        // make a request to localhost:8080
        $.ajax({
            url: 'http://localhost:5000',
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify({
                "country": country,
                "state": state,
                "city": city,
                "phone": phone,
                "location": type == null ? null : type.loc,
            }),
            success: function (data) {

                if(data.episodealertlevel == 'Green'){
                    $('.alert-color').css('background-color', '#10B981');
                    $('#alert-type').text('Green Alert');
                }else if(data.episodealertlevel == 'Yellow'){
                    $('.alert-color').css('background-color', '#FBBF24');
                    $('#alert-type').text('Yellow Alert');
                }else if(data.episodealertlevel == 'Orange'){
                    $('.alert-color').css('background-color', '#F97316');
                    $('#alert-type').text('Orange Alert');
                }else if(data.episodealertlevel == 'Red'){
                    $('.alert-color').css('background-color', '#EF4444');
                    $('#alert-type').text('Red Alert');
                }

                $('#country').text("Country: " + data.country);
                // $('#fromdate').text(data.fromdate);
                // $('#todate').text(data.todate);
                // format date from yyyy-mm-dd 
                var fromdate = new Date(data.fromdate);
                var todate = new Date(data.todate);

                $('#fromdate').text("From: " + fromdate.toLocaleDateString()); // "12/20/2012 12:00:00 AM
                $('#todate').text("To: " + todate.toLocaleDateString()); // "12/20/2012 12:00:00 AM


                generateGlobe(data);
            },
            error: function (error) {
                console.log(error);
            }
        });
    }

    window.onload = function () {

        let dataInfos;

        fetch('https://ipinfo.io/json?token=bf41c91508f173')
        .then(response => response.json())
        .then(data => {
            dataInfos = data;
        })
        .catch(error => {
            console.error('Erro ao obter o endereço IP do cliente:', error);
        });


        loadData(dataInfos);
    };

  </script>
</body>
</html>